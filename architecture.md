# Architecture

## Abstract

This app will present any number of images that will be analyzed and shown using deep looking. Deep looking is the process of applying discipline-specific lenses to an image, where each lens presents information to the user on how intepretation occurs via that lens. For example, an image of a painting containing a picture of a person may be viewed through the lenses of anatomy and computer graphics. A person has a skeleton composed of bones. One way to represent the skeleton is using a scene graph, common in computer graphics. The skeleton can be diagrammed as a tree. A labeled tree illustrating a skeleton is simultaneously visualized, via computer graphs or anatomy as an intepretation of this part of the painting. Interaction involves the curator and the visitor. The visitor is the user who is browsing and navigating a root image.

## Elements

At the root, we have a gallery of images. This gallery is visualized as formatted based on centering thumnails of images on the screen in a grid. A single image appears in the center, underneath gallery title "Deep Looking". Hypertext for Deep Looking can use the text in the previous section (Abstract). Use the 'marsh' or 'lourmarin' examples for guidance.

When mouse-clicked, a thumbnail opens into a web page where the primary user interaction takes place for that full image.  

1. The curator will be asked where the data are stored for that image. This will be a local directory on the file system. The file structure is as follows: Root directory (for example marsh for a picture of marshland). The curator may use @directory to indicate where, and this directory may need to be created, or it may preexist.

2. The curator will be asked about the segments. A segment, in a segmented image of a marsh may boardwalk or sky. These are segments where the visitor's mouse location will fall, triggering. display window. for that segment. The will indicate something about segements needed. There will be one subdirectory for each segment. For boardwalk, there is a boardwalk subdirectory. Preferred segmentation software is Google Nano Banana Pro in Thinking mode if available. Nano Banana Pro will be asked for segments along with labels and color ranges for each segment.
3. Each segment will have any number of lenses: poetry, mathematics (geometry, number theory, art history, etc). There will be a new subdirectory underneath each segment: poetry, for instance.
4. In a lens, there will be a markdown file. This markdown will have a title, image, and additional text. For poetry, this is currently, the name of the poem and poet. The image will be generated by an LLM or provided by the curator (i.e. a file). The title and image may be hyperlinked with the curator indicating which. For marsh as the example, a tile is hyperlinked to the specific poem. The image for the poem is generated from the additional text below the image. The additional text comes from the label assigned for that segment (for instance 'boardwalk' as it appears in a poem along with some previous and following lines of the poem around 'boardwalk').
5. Visitor interaction is a mouseover of the entire image. When a segment is found, a pop-up window appears. If that window is not clicked, the visitor is free to continue mouse hovering. If the window is clicked, then any hyperlinks inside the window are engaged. The window must have an X so the user can return to scanning the root image.

The file structure for a boardwalk looks like this:  deeplooking (root) -> marsh (image) -> boardwalk (segment) -> poetry (lens) -> markdown file (containg information on the window for that segment).

The curator may choose any number of root images and for each image they will indicate something about the image segmentation. The curator works with one image at a time. The curator may specific all details for the file hierarchy or leave up detais to the AI. The two examples (marsh and lourmarin) provide detailed examples.

# Lens Interaction

A question arises as to when to show which lens if there are multiple lenses. In the case where we have a segment that has more than one lens, show each lens as one would show a tab in a browser. Also, some segments even though they exist in the file hierarchy, may not have any lenses. The app knows where these segment masks are located but there is no lens-specific information.

- When a segment has exactly one lens, the popup shows content directly with no tab bar.
- When a segment has two or more lenses, a tab bar appears at the top of the popup. The first lens is shown by default. Clicking a tab switches the content below.
- When a segment has no lenses (empty directory or no markdown files found), no popup appears and the visitor continues hovering.

## File Structure

The app is a single `index.html` that dynamically loads all content from JSON manifests and markdown files. This makes it compatible with GitHub Pages (no server-side code).

```
deeplooking/
  index.html                              — single-page app
  images/
    gallery.json                          — list of image IDs, e.g. ["marsh", "lourmarin"]
    <image>/
      manifest.json                       — image metadata, segments, color rules, lens lists
      <root-image-file>                   — e.g. marsh.jpeg, artwork.WEBP
      segmentation_mask.png               — color-coded mask for segment detection
      <segment>/
        <lens>/
          <segment>.md                    — front-matter + body text
          <optional-image-file>.png       — generated or curator-provided image
```

### manifest.json

Each image directory contains a `manifest.json` with:
- `id` — image identifier matching the directory name
- `title` — display title (artwork name, artist, date)
- `gallery` — name of museum or gallery (optional)
- `galleryUrl` — hyperlink to museum or gallery (optional)
- `image` — filename of the root artwork image
- `mask` — filename of the segmentation mask
- `segments` — array of segment objects, each with:
  - `label` — display label returned by color matching (e.g. "Boardwalk")
  - `dir` — directory name for this segment (e.g. "boardwalk")
  - `lenses` — array of lens names (e.g. ["poetry", "math"])
  - `colorRule` — object with threshold conditions (r_gt, r_lt, g_gt, g_lt, b_gt, b_lt)

### Markdown Format

Each lens markdown file uses simple `key: value` front-matter followed by a blank line, then body text:

```
title: Boardwalk
poet: Herbert Morris
url: https://newcriterion.com/article/boardwalk/
image: marsh_boardwalk.png
keyword: boardwalk

My breath, turned smoke, is rising on the air.
...
```

Fields:
- `title` — display title in the popup (required)
- `poet` — author/attribution line (may be empty)
- `url` — hyperlink activated when popup is pinned (may be empty)
- `image` — filename of image in the same directory (may be empty)
- `keyword` — word to highlight in the body text (may be empty)
